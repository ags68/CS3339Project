# CS3339 Class Project - Red Team

This project simulates a MIPS-like, 5-stage pipeline processor in both Verilog and C++. Both processor simulations implement the following:

* Its own set of 32 registers, each 32-bits wide
* Its own memory of 1024 4-byte words
* IF, ID, EX, MEM, and WB stages
* Forwarding from EX to EX and MEM to EX
* Stalls on load/use hazard
* BTA calculation and branch condition evaluation in ID stage

Both simulations officially supports the instructions lw, sw, add, sub, xor, addi, subi, beq, j, jal, and jr. Handling for the instructions and, or, nor, and slt is included but has not been thoroughly tested, so these instructions are not guaranteed and will not be generated by the test bench.

## Building the Project

The easiest way to build this project is to use the included Makefile. The Makefile was written for an Ubuntu environment and assumes a Linux layout and standard utilities including GNU make and GCC. It is therefore recommended that you use an Ubuntu envrionment as well to avoid any cross-platform complications. An Ubuntu VM should suffice. Other build time dependencies can be installed in an Ubuntu environement using the following:

```
$ sudo add-apt-repository ppa:team-electronics/ppa
$ sudo apt-get update
$ sudo apt-get install verilog
```

With all dependencies installed, simply run `make` in the main directory to build the project.

## Configuring and Running the Project

The project test bench can be executed with the following command: `make run`. At the start of execution, the test bench generates random instructions that are loaded into sequential memory addresses starting at zero. The last instruction will always be `j 0` to return to the first instruction, so the instructions can loop. The generated instructions are written to the file `instructions.out`. Random data is then loaded into the rest of the available memory space to provide nonzero data to the processors. The generated data is written to the file `data.out`. To control this generation, the test bench pulls several configuration parameters from the file `configuration.hex`. They are:

1. **Seed**: Number used to seed the pseudorandom number generator in Verilog used to generate instructions and data. Modify this to generate a different set of instructions.
  
2. **Load/Store percentage**: Controls what percentage of the generated instructions will be either `lw` or `sw`. If this is 100 or greater, only load/store instructions will be generated.
  
3. **Branch percentage**: Controls what percentage of the generated instructions will be either `beq`, `j`, `jr`, or `jal`. If this plus the load store percentage is 100 or greater, no alu instructions will be generated, and the percentage of branch instructions will be 100 minus the load/store percentage.

4. **Number of instructions**: Controls the number of instructions to generate. This should be kept less than the number of word address in memory (1024).

5. **Number of cycles**: Controls the number of cycles that will be completed after all instructions and data have been generated and loaded into the processor memories.

6. **Print cycle**: Specifies a cycle on which the test bench will print the contents of the Verilog and C++ register files side by side for comparison. This should be used in lieu of a "pause" function.

On each cycle, the test bench compares the values in the Verilog and C++ register files and prints a message if it detects a mismatch. If no mismatches are detected, a message indicating that is printed as execution ends.

The test bench will generate a value change dump file `processor_tb.vcd` which can be inspected using GTKWave. The values in the register file and memory are not included in the vcd file since the only way to include these values produces excessive warnings at run time. GTKWave can be installed on Ubuntu using the following:

```
$ sudo apt-get install gtkwave
```

## Testing the Project

Unit tests were created for all low level components, and integration tests were created for the C++ stages. The C++ test suite requires Google Test to run which can be installed on Ubuntu using the following:

```
$ sudo apt-get install libgtest-dev
```

With Google Test installed, the C++ can be run with the following command: `make ctest`. Verilog tests have no additional dependencies beyond the runtime dependencies and can be run with the following command: `make vtest`. All tests can be run at once with the following command: `make test`.


## Results

The test bench has been run several times for 1000 cycles with various values for seed, load/store percentage, and branch percentage without detecting a register mismatch.
